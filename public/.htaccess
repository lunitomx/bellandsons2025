# Bell & Sons - Apache Configuration
# Performance and Security Optimizations

# Enable Compression
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/xml
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE application/xml
    AddOutputFilterByType DEFLATE application/xhtml+xml
    AddOutputFilterByType DEFLATE application/rss+xml
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/x-javascript
    AddOutputFilterByType DEFLATE image/svg+xml
</IfModule>

# Browser Caching
<IfModule mod_expires.c>
    ExpiresActive On
    
    # Images
    ExpiresByType image/jpg "access plus 1 year"
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/webp "access plus 1 year"
    ExpiresByType image/svg+xml "access plus 1 year"
    
    # CSS and JavaScript
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
    ExpiresByType application/x-javascript "access plus 1 month"
    
    # Fonts
    ExpiresByType font/woff2 "access plus 1 year"
    ExpiresByType font/woff "access plus 1 year"
    ExpiresByType font/ttf "access plus 1 year"
    ExpiresByType application/font-woff "access plus 1 year"
    
    # HTML
    ExpiresByType text/html "access plus 1 hour"
    ExpiresByType application/xhtml+xml "access plus 1 hour"
</IfModule>

# Security Headers
<IfModule mod_headers.c>
    # X-Frame-Options
    Header always set X-Frame-Options "SAMEORIGIN"
    
    # X-Content-Type-Options
    Header always set X-Content-Type-Options "nosniff"
    
    # X-XSS-Protection
    Header always set X-XSS-Protection "1; mode=block"
    
    # Referrer Policy
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    
    # Permissions Policy
    Header always set Permissions-Policy "geolocation=(), microphone=(), camera=()"
</IfModule>

# Canonical domain and HTTPS redirect
<IfModule mod_rewrite.c>
    RewriteEngine On
    
    # Canonical + HTTPS
    RewriteCond %{HTTPS} !=on [OR]
    RewriteCond %{HTTP_HOST} !^bellandsons\.com\.mx$ [NC]
    RewriteRule ^(.*)$ https://bellandsons.com.mx/$1 [R=301,L]
</IfModule>

# Product and Collection Redirects to Catalog
<IfModule mod_rewrite.c>
    # Specific product redirects
    RedirectMatch 301 ^/products/tablero-marmol-pvc-color-obscuro/?$ https://bellandsons.com.mx/catalogo/
    RedirectMatch 301 ^/products/tablero-marmo-pvc/?$ https://bellandsons.com.mx/catalogo/
    RedirectMatch 301 ^/products/lambrin-wpc-white-cedar/?.*$ https://bellandsons.com.mx/catalogo/
    RedirectMatch 301 ^/products/caja-de-18-lambrines-wpc-color-colorado-oak/?$ https://bellandsons.com.mx/catalogo/
    RedirectMatch 301 ^/products/lambrin-wpc-color-chocolate/?$ https://bellandsons.com.mx/catalogo/
    RedirectMatch 301 ^/products/lambrin-wpc-color-marmoleado-claro/?$ https://bellandsons.com.mx/catalogo/
    RedirectMatch 301 ^/products/lambrin-wpc-color-parota/?$ https://bellandsons.com.mx/catalogo/
    RedirectMatch 301 ^/products/lambrin-wpc-color-negro/?$ https://bellandsons.com.mx/catalogo/
    RedirectMatch 301 ^/products/lambrin-wpc-color-gris-1/?.*$ https://bellandsons.com.mx/catalogo/
    RedirectMatch 301 ^/products/lambrines-wpc-color-walnut/?$ https://bellandsons.com.mx/catalogo/
    RedirectMatch 301 ^/products/spc-flooring-1919/?$ https://bellandsons.com.mx/catalogo/
    RedirectMatch 301 ^/products/lambrin-wpc-color-marmoleado-obscuro/?$ https://bellandsons.com.mx/catalogo/
    RedirectMatch 301 ^/products/lambrin-wpc-color-gris/?$ https://bellandsons.com.mx/catalogo/
    RedirectMatch 301 ^/products/caja-de-18-lambrines-wpc-color-aspen-grey/?$ https://bellandsons.com.mx/catalogo/
    RedirectMatch 301 ^/products/spc-flooring-2077/?$ https://bellandsons.com.mx/catalogo/
    RedirectMatch 301 ^/products/spc-flooring-maplegris/?$ https://bellandsons.com.mx/catalogo/
    RedirectMatch 301 ^/products/piso-deck-para-exterior/?$ https://bellandsons.com.mx/catalogo/
    RedirectMatch 301 ^/products/spc-flooring-abedul/?$ https://bellandsons.com.mx/catalogo/
    RedirectMatch 301 ^/products/spc-flooring-cacao/?$ https://bellandsons.com.mx/catalogo/
    RedirectMatch 301 ^/products/spc-flooring-1935/?$ https://bellandsons.com.mx/catalogo/
    RedirectMatch 301 ^/products/spc-flooring-1965/?$ https://bellandsons.com.mx/catalogo/
    RedirectMatch 301 ^/products/spc-flooring-1906/?$ https://bellandsons.com.mx/catalogo/
    RedirectMatch 301 ^/products/spc-flooring-eucalipto/?$ https://bellandsons.com.mx/catalogo/
    RedirectMatch 301 ^/products/spc-flooring-castano/?$ https://bellandsons.com.mx/catalogo/
    
    # Collection redirects
    RedirectMatch 301 ^/collections/laminas-de-marmol-pvc/?.*$ https://bellandsons.com.mx/catalogo/
    RedirectMatch 301 ^/collections/frontpage/?$ https://bellandsons.com.mx/catalogo/
    RedirectMatch 301 ^/collections/all/?.*$ https://bellandsons.com.mx/catalogo/
    RedirectMatch 301 ^/collections/pisos/?$ https://bellandsons.com.mx/catalogo/
    
    # Page redirects
    RedirectMatch 301 ^/pages/contact/?$ https://bellandsons.com.mx/#contacto
    RedirectMatch 301 ^/pages/envios-y-devoluciones/?$ https://bellandsons.com.mx/catalogo/
    RedirectMatch 301 ^/pages/distribuidores/?$ https://bellandsons.com.mx/#contacto
    RedirectMatch 301 ^/pages/aviso-de-privacidad/?$ https://bellandsons.com.mx/catalogo/
    RedirectMatch 301 ^/pages/terminos-y-condiciones/?$ https://bellandsons.com.mx/catalogo/
    RedirectMatch 301 ^/pages/preguntas-frecuentes/?$ https://bellandsons.com.mx/#faq
    
    # App redirects
    RedirectMatch 301 ^/apps/wpdapp/?.*$ https://bellandsons.com.mx/catalogo/
    
    # Fallback: any remaining products or collections to catalog
    RewriteRule ^products/ https://bellandsons.com.mx/catalogo/ [R=301,L]
    RewriteRule ^collections/ https://bellandsons.com.mx/catalogo/ [R=301,L]
    RewriteRule ^pages/ https://bellandsons.com.mx/catalogo/ [R=301,L]
    RewriteRule ^apps/ https://bellandsons.com.mx/catalogo/ [R=301,L]
</IfModule>

# Remove trailing slashes
<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{THE_REQUEST} /+([^?]*?)/?(\?[^\s]*)?(\s|\?)
    RewriteRule ^ /%1%2 [R=301,L]
</IfModule>

# Block malicious requests
<IfModule mod_rewrite.c>
    RewriteEngine On
    
    # Block SQL injection attempts
    RewriteCond %{QUERY_STRING} (\<|%3C).*script.*(\>|%3E) [NC,OR]
    RewriteCond %{QUERY_STRING} GLOBALS(=|\[|\%[0-9A-Z]{0,2}) [OR]
    RewriteCond %{QUERY_STRING} _REQUEST(=|\[|\%[0-9A-Z]{0,2}) [OR]
    RewriteCond %{QUERY_STRING} proc/self/environ [OR]
    RewriteCond %{QUERY_STRING} mosConfig_[a-zA-Z_]{1,21}(=|\%3D) [OR]
    RewriteCond %{QUERY_STRING} base64_(en|de)code\(.*\) [OR]
    RewriteCond %{QUERY_STRING} (\<|%3C).*iframe.*(\>|%3E) [NC]
    RewriteRule .* - [F]
</IfModule>

# Custom Error Pages
ErrorDocument 404 /404.html
ErrorDocument 500 /500.html

# MIME Types for newer formats
<IfModule mod_mime.c>
    AddType image/webp .webp
    AddType font/woff2 .woff2
    AddType application/manifest+json .webmanifest
</IfModule>
